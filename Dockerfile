# -----------------------------------------------------------------------------
# Terraform
# -----------------------------------------------------------------------------

FROM hashicorp/terraform:1.1.5 AS terraform

# -----------------------------------------------------------------------------
# TfLint
# -----------------------------------------------------------------------------

FROM ghcr.io/terraform-linters/tflint:v0.34.1 AS tflint

# -----------------------------------------------------------------------------
# CfSec
# -----------------------------------------------------------------------------

FROM aquasec/cfsec:v0.3.2 AS cfsec

# -----------------------------------------------------------------------------
# TfSec
# -----------------------------------------------------------------------------

FROM aquasec/tfsec:v0.63.1 AS tfsec

# -----------------------------------------------------------------------------
# Trivy
# -----------------------------------------------------------------------------

FROM aquasec/trivy:0.23.0 AS trivy

# -----------------------------------------------------------------------------
# python3
# -----------------------------------------------------------------------------

FROM python:3.9.10-alpine3.15

# -----------------------------------------------------------------------------
# Install 
# -----------------------------------------------------------------------------

RUN apk --no-cache add gcc musl-dev git curl jq bash python3-dev libffi-dev openssl-dev cargo make
RUN pip3 install azure-cli awscli boto3 elasticsearch requests requests-aws4auth

# -----------------------------------------------------------------------------
# Migrate binaries 
# -----------------------------------------------------------------------------

COPY --from=terraform /bin/terraform /bin/terraform
COPY --from=tflint /usr/local/bin/tflint /bin/tflint
COPY --from=tfsec /usr/bin/tfsec /bin/tfsec
COPY --from=cfsec /usr/bin/cfsec /bin/cfsec
COPY --from=trivy /usr/local/bin/trivy /bin/trivy
